<!DOCTYPE html>
<html>
<head>
    <meta charset="utf-8"/>
    <meta name="viewport"
          content="width=device-width,initial-scale=1.0,maixmum-scale=1.0,minimum-scale=1.0,user-scalable=no">
    <title>主页-景区数据可视化系统</title>
    <link rel="stylesheet" href="https://unpkg.zhimg.com/element-ui/lib/theme-chalk/index.css">
    <link rel="stylesheet" href="static/css/index.css">
    <script src="https://unpkg.zhimg.com/vue@2.6.12/dist/vue.js"></script>
    <script src="https://unpkg.zhimg.com/element-ui/lib/index.js"></script>
    <script src="static/js/jquery-2.2.3.min.js"></script>

</head>
<body>
<div id="indexLogin">
    <div class="loginCon">
        <div class="login">
            <div class="login_left">
                <h4 v-if="!isReg">会员登录</h4>
                <h4 v-else>会员注册</h4>
                <div>
                    <el-form ref="form" :model="form" label-width="80px">
                        <el-form-item label="">
                            <el-input v-model="form.username" placeholder="您的账号"></el-input>
                        </el-form-item>
                        <el-form-item label="">
                            <el-input v-model="form.password" type="password" placeholder="您的密码"></el-input>
                        </el-form-item>

                        <el-form-item label="" v-if="isReg">
                            <el-input v-model="form.nickname" placeholder="您的昵称"></el-input>
                        </el-form-item>
                        <div class="loginCon_bottom" v-if="isReg">
                            <div><span @click="toLogin">马上登录</span></div>
                        </div>
                        <div class="loginCon_bottom" v-else>
                            <div><span @click="toReg">立即注册</span></div>
                        </div>
                        <div style="text-align: center;" v-if="isReg">
                            <el-button type="warning" style="width: 220px;margin-left: 80px;" @click="onReg">立即注册
                            </el-button>
                        </div>
                        <div style="text-align: center;" v-else>
                            <el-button type="warning" style="width: 220px;margin-left: 80px;" @click="onSubmit">登录
                            </el-button>
                        </div>
                        <div style="height: 30px;"></div>
                    </el-form>
                </div>
            </div>
        </div>
    </div>
</div>
</body>
<!-- 全局js -->
<script>


    var basePath = "/" + window.location.pathname.split("/")[1];
    var indexApp = new Vue({
        el: "#indexLogin",
        data() {
            return {
                form: {},
                isReg: false,
            }
        },
        created() {

        },
        mounted() {
        },
        methods: {
            onSubmit() {
                if (this.form.username == '' || this.form.password == '') {
                    return this.$message.error('请输入账号或密码！');
                }
                let that = this;
                $.ajax({
                    type: "get",
                    url: basePath + "/app_user/queryAppUserKey",
                    async: false,
                    data: that.form,
                    success: function (data) {

                        if (data.status == 0 && data.data.length > 0) {

                            console.log(data.data)
                            var obj = JSON.stringify(data.data[0]);
                            localStorage.setItem('webInfo', obj);
                            window.location.href = basePath + "/index";
                        } else {
                            that.$alert('<strong style="color:red;">账号或密码错误，请重新输入</strong>', '警告', {
                                dangerouslyUseHTMLString: true
                            });
                        }
                    },
                    error: function () {
                        that.flag = false;
                        that.fullscreenLoading = false;
                        that.$confirm('登录错误，请重试?', '提示', {
                            confirmButtonText: '确定',
                            cancelButtonText: '取消',
                            type: 'warning'
                        }).then(() => {
                        }).catch(() => {
                        });
                    }
                });
            },
            onReg() {
                var that = this;
                $.ajax({
                    type: "GET",
                    url: `${basePath}/app_user/queryAppUserKey`,
                    data: {username: that.form.username},
                    success: function (data) {
                        if (data.data.length > 0) {
                            that.$confirm('账号已存在，请换一个?', '提示', {
                                confirmButtonText: '确定',
                                cancelButtonText: '取消',
                                type: 'warning'
                            }).then(() => {

                            }).catch(() => {
                            });
                        } else {
                            $.ajax({
                                type: "GET",
                                url: `${basePath}/app_user/addAppUserNo`,
                                data: that.form,
                                success: function (data) {
                                    if (data.status == 0) {
                                        that.$confirm('账号创建成功，前往登录?', '提示', {
                                            confirmButtonText: '确定',
                                            cancelButtonText: '取消',
                                            type: 'warning'
                                        }).then(() => {
                                            that.form = {
                                                username: '',
                                                password: ''
                                            };
                                            that.isReg = false;
                                        }).catch(() => {
                                        });
                                    }
                                }
                            })
                        }
                    }
                })
            },
            toReg() {
                this.form = {
                    username: '',
                    password: '',
                    nickname: ''
                };
                this.isReg = true;
            },
            toLogin() {
                this.form = {
                    username: '',
                    password: ''
                };
                this.isReg = false;
            },
            toReg() {
                this.form = {
                    username: '',
                    password: '',
                    nickname: ''
                };
                this.isReg = true;
            },

        }
    })
</script>
</html>
